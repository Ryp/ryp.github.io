<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>CHIP-8 Emulator: Rust port | Pixels May Jitter</title>
<meta name=keywords content>
<meta name=description content="tl;dr: I ported my CHIP-8 emulator to Rust.
Amongst game dev circles, Rust is certainly getting a lot of attention recently, especially since Ready At Dawn announced they would be switching entirely to Rust for newly-written code. This is certainly a big thing, coming from such an experienced studio (we gamedevs are notoriously picky when adopting new libraries/languages), and proves that Rust is taken seriously for replacing C++.
Personally, I tend to dislike C++ and its ecosystem, and couldn&rsquo;t be happier that new languages try address the need for a superior paradigm.">
<meta name=author content>
<link rel=canonical href=https://ryp.github.io/posts/chip8-emulator-rust/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ryp.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://ryp.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://ryp.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://ryp.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://ryp.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><meta property="og:title" content="CHIP-8 Emulator: Rust port">
<meta property="og:description" content="tl;dr: I ported my CHIP-8 emulator to Rust.
Amongst game dev circles, Rust is certainly getting a lot of attention recently, especially since Ready At Dawn announced they would be switching entirely to Rust for newly-written code. This is certainly a big thing, coming from such an experienced studio (we gamedevs are notoriously picky when adopting new libraries/languages), and proves that Rust is taken seriously for replacing C++.
Personally, I tend to dislike C++ and its ecosystem, and couldn&rsquo;t be happier that new languages try address the need for a superior paradigm.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ryp.github.io/posts/chip8-emulator-rust/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-07-09T12:00:00+03:00">
<meta property="article:modified_time" content="2019-07-09T12:00:00+03:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="CHIP-8 Emulator: Rust port">
<meta name=twitter:description content="tl;dr: I ported my CHIP-8 emulator to Rust.
Amongst game dev circles, Rust is certainly getting a lot of attention recently, especially since Ready At Dawn announced they would be switching entirely to Rust for newly-written code. This is certainly a big thing, coming from such an experienced studio (we gamedevs are notoriously picky when adopting new libraries/languages), and proves that Rust is taken seriously for replacing C++.
Personally, I tend to dislike C++ and its ecosystem, and couldn&rsquo;t be happier that new languages try address the need for a superior paradigm.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ryp.github.io/posts/"},{"@type":"ListItem","position":2,"name":"CHIP-8 Emulator: Rust port","item":"https://ryp.github.io/posts/chip8-emulator-rust/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CHIP-8 Emulator: Rust port","name":"CHIP-8 Emulator: Rust port","description":"tl;dr: I ported my CHIP-8 emulator to Rust.\nAmongst game dev circles, Rust is certainly getting a lot of attention recently, especially since Ready At Dawn announced they would be switching entirely to Rust for newly-written code. This is certainly a big thing, coming from such an experienced studio (we gamedevs are notoriously picky when adopting new libraries/languages), and proves that Rust is taken seriously for replacing C++.\nPersonally, I tend to dislike C++ and its ecosystem, and couldn\u0026rsquo;t be happier that new languages try address the need for a superior paradigm.","keywords":[],"articleBody":"tl;dr: I ported my CHIP-8 emulator to Rust.\nAmongst game dev circles, Rust is certainly getting a lot of attention recently, especially since Ready At Dawn announced they would be switching entirely to Rust for newly-written code. This is certainly a big thing, coming from such an experienced studio (we gamedevs are notoriously picky when adopting new libraries/languages), and proves that Rust is taken seriously for replacing C++.\nPersonally, I tend to dislike C++ and its ecosystem, and couldn’t be happier that new languages try address the need for a superior paradigm. C++ is full of traps and requires a lot of discipline to produce maintainable code.\nI thought it would be a nice start to just take existing code and try to see how well it would translate from C++. I simply took my previous CHIP-8 emu and started to chip at it with the help of the docs.\nIf you want to dive right in, here’s the code on GitHub.\nAnyway, it was my first go at Rust so go easy on me! =)\nFirst impressions I must say I was pleasantly surprised with the experience overall. The docs are available and uploaded to a common platform, which makes them easy to read since the format is always the same.\nAdding dependencies is a breeze, and the whole buildsystem (man cargo) is simple enough to get things going fast. Being used to fiddle with CMake regularly, this is a big improvement.\nI wish that rust packages and my distro packages would use the same software though… It really feels wrong to have each new language rewrite its own package manager from scratch. Stop reinventing the wheel!\nThe best feature in my eyes for now is the way Rust handles ownership. The fact that ownership can be asserted at compile time is a very powerful asset.\nRust provides you with the right tool to deal with memory safely, with array slices for example. This allows Rust to warn you when manipulating two variables that point to the same mutable memory in the same scope for example.\nThis is only a superficial overview of what I’ve been able to see so far, but that gives you a rough idea of my initial impression with this tech.\nDebug builds The big issue I’m seeing for now is the debug performance. My first working executable was running dog slow! Get that: for one rendered frame of the emu in ~1080p, I would spend ~1000ms filling the backbuffer on the CPU! The release build would run at about 42ms for the same test.\nAfter profiling it seems like Rust spends a LOT of time validating, almost all of that time was spent in iterator and range debug validation.\nMy initial backbuffer filling routine was of course naive and non-optimized, so after spending a couple of hours improving it, I got this result:\n| Debug | 500ms | | Release | ~7ms |\nThe gain from 42ms to 7ms was expected in my release build, as I roughly cut the work needed in my code by 8, but I was not expecting my debug perf to stay at 500ms.\nConclusion I don’t know what to think about the debug times yet, I probably need to ask around and see if that’s an isolated case or if there’s a way to mitigate this.\nDespite that, Rust definitely feels like a well thought-out language and I’ll be programming with it more in the future!\n","wordCount":"578","inLanguage":"en","datePublished":"2019-07-09T12:00:00+03:00","dateModified":"2019-07-09T12:00:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ryp.github.io/posts/chip8-emulator-rust/"},"publisher":{"@type":"Organization","name":"Pixels May Jitter","logo":{"@type":"ImageObject","url":"https://ryp.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://ryp.github.io/ accesskey=h title="Pixels May Jitter (Alt + H)">Pixels May Jitter</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
CHIP-8 Emulator: Rust port
</h1>
<div class=post-meta>July 9, 2019
</div>
</header>
<div class=post-content><p><strong>tl;dr:</strong> I ported my CHIP-8 emulator to Rust.</p>
<p>Amongst game dev circles, Rust is certainly getting a lot of attention recently,
especially since Ready At Dawn announced they would be <a href=https://twitter.com/AndreaPessino/status/1021532074153394176>switching entirely to
Rust for newly-written code</a>.
This is certainly a big thing, coming from such an experienced studio
(we gamedevs are notoriously picky when adopting new libraries/languages),
and proves that Rust is taken seriously for replacing C++.</p>
<p>Personally, I tend to dislike C++ and its ecosystem, and couldn&rsquo;t be happier
that new languages try address the need for a superior paradigm. C++ is full of
traps and requires a lot of discipline to produce maintainable code.</p>
<p>I thought it would be a nice start to just take existing code and try to see how
well it would translate from C++. I simply took my <a href=https://github.com/Ryp/chip8-emu>previous CHIP-8 emu</a> and started
to chip at it with the help of the docs.</p>
<p>If you want to dive right in, here&rsquo;s the code on <a href=https://github.com/Ryp/chip8-emu-rs>GitHub</a>.</p>
<p>Anyway, it was my first go at Rust so go easy on me! =)</p>
<h2 id=first-impressions>First impressions<a hidden class=anchor aria-hidden=true href=#first-impressions>#</a></h2>
<p>I must say I was pleasantly surprised with the experience overall. The docs are
available and uploaded to a common platform, which makes them easy to read since
the format is always the same.</p>
<p>Adding dependencies is a breeze, and the whole buildsystem (<code>man cargo</code>) is simple enough to
get things going fast. Being used to fiddle with CMake regularly, this is a <strong>big</strong>
improvement.</p>
<p>I wish that rust packages and my distro packages would use the same software
though&mldr; It really feels wrong to have each new language rewrite its
own package manager from scratch. Stop reinventing the wheel!</p>
<p>The best feature in my eyes for now is the way Rust handles ownership. The fact
that ownership can be asserted at compile time is a very powerful asset.</p>
<p>Rust provides you with the right tool to deal with memory safely, with array slices for
example. This allows Rust to warn you when manipulating two variables that point to the same
mutable memory in the same scope for example.</p>
<p>This is only a superficial overview of what I&rsquo;ve been able to see so far, but
that gives you a rough idea of my initial impression with this tech.</p>
<h2 id=debug-builds>Debug builds<a hidden class=anchor aria-hidden=true href=#debug-builds>#</a></h2>
<p>The big issue I&rsquo;m seeing for now is the debug performance. My first working
executable was running dog slow! Get that: for one rendered frame of the emu in
~1080p, I would spend <strong>~1000ms</strong> filling the backbuffer on the CPU!
The release build would run at about <strong>42ms</strong> for the same test.</p>
<p>After profiling it seems like Rust spends a LOT of time validating,
almost all of that time was spent in iterator and range debug validation.</p>
<p>My initial <a href=https://github.com/Ryp/chip8-emu-rs/blob/master/src/sdl2/backend.rs#L80>backbuffer filling routine</a> was of course naive and non-optimized, so
after spending a couple of hours improving it, I got this result:</p>
<p>| <strong>Debug</strong> | 500ms |
| <strong>Release</strong> | ~7ms |</p>
<p>The gain from 42ms to 7ms was expected in my release build, as I roughly cut the
work needed in my code by 8, but I was not expecting my debug perf to stay at
500ms.</p>
<h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>I don&rsquo;t know what to think about the debug times yet, I probably need to ask
around and see if that&rsquo;s an isolated case or if there&rsquo;s a way to mitigate this.</p>
<p>Despite that, Rust definitely feels like a well thought-out language and I&rsquo;ll be
programming with it more in the future!</p>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://ryp.github.io/>Pixels May Jitter</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
</body>
</html>