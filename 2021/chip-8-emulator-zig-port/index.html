<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CHIP-8 Emulator: Zig port | Pixels May Jitter</title>
<meta name=keywords content="zig,chip8"><meta name=description content="After porting a CHIP-8 emulator to Rust (repo on GitHub), I decided to come back to trying new languages, feeling like Rust isn&rsquo;t at a state where I would consider writing new code in it. So if not Rust, what kind shiny new thing is around on the block?
Zig Zig has been around some time now, the community is active but didn&rsquo;t grow into large scale yet. It seems to aim at low-level programmers, as a safer alternative to C with a lean feature set and better performance."><meta name=author content><link rel=canonical href=https://ryp.github.io/2021/chip-8-emulator-zig-port/><link crossorigin=anonymous href=/assets/css/stylesheet.9329d037bc79464b26647fb72e079cd738f5d2418b1df4da3b515db9e22cb4d9.css integrity="sha256-kynQN7x5RksmZH+3Lgec1zj10kGLHfTaO1FdueIstNk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://ryp.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ryp.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ryp.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ryp.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ryp.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="CHIP-8 Emulator: Zig port"><meta property="og:description" content="After porting a CHIP-8 emulator to Rust (repo on GitHub), I decided to come back to trying new languages, feeling like Rust isn&rsquo;t at a state where I would consider writing new code in it. So if not Rust, what kind shiny new thing is around on the block?
Zig Zig has been around some time now, the community is active but didn&rsquo;t grow into large scale yet. It seems to aim at low-level programmers, as a safer alternative to C with a lean feature set and better performance."><meta property="og:type" content="article"><meta property="og:url" content="https://ryp.github.io/2021/chip-8-emulator-zig-port/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-04T12:00:00+03:00"><meta property="article:modified_time" content="2021-07-04T12:00:00+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="CHIP-8 Emulator: Zig port"><meta name=twitter:description content="After porting a CHIP-8 emulator to Rust (repo on GitHub), I decided to come back to trying new languages, feeling like Rust isn&rsquo;t at a state where I would consider writing new code in it. So if not Rust, what kind shiny new thing is around on the block?
Zig Zig has been around some time now, the community is active but didn&rsquo;t grow into large scale yet. It seems to aim at low-level programmers, as a safer alternative to C with a lean feature set and better performance."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ryp.github.io/posts/"},{"@type":"ListItem","position":2,"name":"CHIP-8 Emulator: Zig port","item":"https://ryp.github.io/2021/chip-8-emulator-zig-port/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CHIP-8 Emulator: Zig port","name":"CHIP-8 Emulator: Zig port","description":"After porting a CHIP-8 emulator to Rust (repo on GitHub), I decided to come back to trying new languages, feeling like Rust isn\u0026rsquo;t at a state where I would consider writing new code in it. So if not Rust, what kind shiny new thing is around on the block?\nZig Zig has been around some time now, the community is active but didn\u0026rsquo;t grow into large scale yet. It seems to aim at low-level programmers, as a safer alternative to C with a lean feature set and better performance.","keywords":["zig","chip8"],"articleBody":"After porting a CHIP-8 emulator to Rust (repo on GitHub), I decided to come back to trying new languages, feeling like Rust isn’t at a state where I would consider writing new code in it. So if not Rust, what kind shiny new thing is around on the block?\nZig Zig has been around some time now, the community is active but didn’t grow into large scale yet. It seems to aim at low-level programmers, as a safer alternative to C with a lean feature set and better performance. I kept hearing good things about it, so I decided it was time to give it a try and see if it would be a ‘better C’.\nStarting simple, I took an existing small C++ codebase and began converting bit by bit. If you want to dive right in, here’s the code on GitHub.\nThis write-up won’t be a full feature tour nor a “Look at this awesome new language, let’s rewrite the planet with it” piece - but rather a few notes on what I found noteworthy while doing my port.\nNoteworthy Zig things Interoperability with C code So, one thing I always dislike is how much every new language likes to lock in users into its ecosystem. Yes Rust, I’m looking at you.\nIt usually goes like this:\nUse new shiny language Good-old library that you always used before is not available Scenario 1: Someone was here before, went through the pain of writing bindings. Great - except they are out-of-date 9 times out of 10. Scenario 2: No luck, your turn to suffer - enjoy writing bindings between two languages that were never meant to work together, for an API that is ten times as large as your use case, then maintain it forever please. Scratch chin and look back at your life decisions Instead of this, Zig supports including C code directly in the zig source file. Just prefix your usual C code with the namespace of your choosing, prepare to add a few harmless casts, and you’re good to go.\nYes. That simple.\nDraw me a pointer All pointers are non-nullable by default. This is great! No need to add those verbose checks at every function start - pointers you get always point to something.\nWhen you need a nullable pointer, they are supported too with the ? syntax added to the type. It’s a big win for safety in my opinion.\nOne slightly more uncomfortable side of pointer are the small zoo of variants that exist. Which one do I use: *u8? []u8? [*]u8? *[N]u8? Reading the docs makes that clearer but it’s not something I expected at first. Expect some fighting with the compiler for array types and operations.\nDefer Zig does NOT support constructors and destructors like regular OOP languages. My opinion is still torn on this one, but at least we get something new out of it.\nThe new defer (and its friend errdefer) allows you to defer execution to the end of the scope. One way to imitate the usual OOP-style contruct is the following:\nfoo_ctor(); defer foo_dtor(); ... defer and errdefer integrate very nicely with the rest of the language regarding error handling. I won’t go into much more details here, but trust me - it’s really nice!\nI really don’t like not having a one-liner way of writing stuff like profiling macros anymore (and other scope-style objects), but I guess it’s not a total deal breaker either.\nNo macros Yup. Goodbye.\nNo C-style for loops You read that right, your beloved for (int i = 0; i \u003c size; i++) hardcoded in your fingertips won’t work. It simply and purely not supported.\nThe foreach-style for is still supported mind you, but the old integer-based counter is not. You will have to accept to write a while loop, that’s not the end of the world though!\nComing to think of it a bit more, the C-style for syntax we are so used to is quite weird after all - three expressions inside of a single parenthesis set? Zig simply forces us to be slightly more verbose, nothing crazy in my opinion.\nConclusion There’s plenty of interesting subjects I didn’t talk about of course, but hopefully this gives you some insights into this shiny language. On my end, I’m interested into what Zig will evolve into, I see a good potential there.\n","wordCount":"731","inLanguage":"en","datePublished":"2021-07-04T12:00:00+03:00","dateModified":"2021-07-04T12:00:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ryp.github.io/2021/chip-8-emulator-zig-port/"},"publisher":{"@type":"Organization","name":"Pixels May Jitter","logo":{"@type":"ImageObject","url":"https://ryp.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ryp.github.io/ accesskey=h title="Pixels May Jitter (Alt + H)">Pixels May Jitter</a><div class=logo-switches></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>CHIP-8 Emulator: Zig port</h1><div class=post-meta><span title='2021-07-04 12:00:00 +0300 +0300'>July 4, 2021</span></div></header><div class=post-content><p>After porting a CHIP-8 emulator to Rust (repo on <a href=https://github.com/Ryp/chip8-emu-rs>GitHub</a>),
I decided to come back to trying new languages, feeling like Rust isn&rsquo;t at a state where I would consider writing new code in it.
So if not Rust, what kind shiny new thing is around on the block?</p><h1 id=zig>Zig<a hidden class=anchor aria-hidden=true href=#zig>#</a></h1><p><a href=https://ziglang.org>Zig</a> has been around some time now, the community is active but didn&rsquo;t grow into large scale yet.
It seems to aim at low-level programmers, as a safer alternative to C with a lean feature set and better performance.
I kept hearing good things about it, so I decided it was time to give it a try and see if it would be a &lsquo;better C&rsquo;.</p><p>Starting simple, I took an existing small C++ codebase and began converting bit by bit.
If you want to dive right in, here&rsquo;s the code on <a href=https://github.com/Ryp/chip8-emu-zig>GitHub</a>.</p><p>This write-up won&rsquo;t be a full feature tour nor a &ldquo;<em>Look at this awesome new language, let&rsquo;s rewrite the planet with it</em>&rdquo; piece -
but rather a few notes on what I found noteworthy while doing my port.</p><h1 id=noteworthy-zig-things>Noteworthy Zig things<a hidden class=anchor aria-hidden=true href=#noteworthy-zig-things>#</a></h1><h2 id=interoperability-with-c-code>Interoperability with C code<a hidden class=anchor aria-hidden=true href=#interoperability-with-c-code>#</a></h2><p>So, one thing I always dislike is how much every new language likes to lock in users into its ecosystem.
Yes Rust, I&rsquo;m looking at you.</p><p>It usually goes like this:</p><ul><li>Use <em>new shiny language</em></li><li><em>Good-old library</em> that you always used before is not available<ul><li>Scenario 1: Someone was here before, went through the pain of writing bindings.
Great - except they are out-of-date 9 times out of 10.</li><li>Scenario 2: No luck, your turn to suffer - enjoy writing bindings between two languages that were never meant to work together,
for an API that is ten times as large as your use case, then maintain it forever please.</li></ul></li><li>Scratch chin and look back at your life decisions</li></ul><p>Instead of this, Zig supports including C code directly in the zig source file.
Just prefix your usual C code with the namespace of your choosing,
prepare to add a few harmless casts, and you&rsquo;re good to go.</p><p>Yes. That simple.</p><h2 id=draw-me-a-pointer>Draw me a pointer<a hidden class=anchor aria-hidden=true href=#draw-me-a-pointer>#</a></h2><p>All pointers are non-nullable by default. This is great! No need to add those verbose checks at every function start - pointers you get always point to something.</p><p>When you need a nullable pointer, they are supported too with the <code>?</code> syntax added to the type.
It&rsquo;s a big win for safety in my opinion.</p><p>One slightly more uncomfortable side of pointer are the small zoo of variants that exist. Which one do I use: <code>*u8</code>? <code>[]u8</code>? <code>[*]u8</code>? <code>*[N]u8</code>?
Reading the docs makes that clearer but it&rsquo;s not something I expected at first. Expect some fighting with the compiler for array types and operations.</p><h2 id=defer>Defer<a hidden class=anchor aria-hidden=true href=#defer>#</a></h2><p>Zig does NOT support constructors and destructors like regular OOP languages. My opinion is still torn on this one, but at least we get something new out of it.</p><p>The new <code>defer</code> (and its friend <code>errdefer</code>) allows you to <em>defer</em> execution to the end of the scope.
One way to imitate the usual OOP-style contruct is the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span>foo_ctor();
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> foo_dtor();
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p><code>defer</code> and <code>errdefer</code> integrate very nicely with the rest of the language regarding error handling. I won&rsquo;t go into much more details here, but trust me - it&rsquo;s really nice!</p><p>I really don&rsquo;t like not having a one-liner way of writing stuff like profiling macros anymore (and other scope-style objects), but I guess it&rsquo;s not a total deal breaker either.</p><h2 id=no-macros>No macros<a hidden class=anchor aria-hidden=true href=#no-macros>#</a></h2><p>Yup. Goodbye.</p><h2 id=no-c-style-for-loops>No C-style for loops<a hidden class=anchor aria-hidden=true href=#no-c-style-for-loops>#</a></h2><p>You read that right, your beloved <code>for (int i = 0; i &lt; size; i++)</code> hardcoded in your fingertips won&rsquo;t work. It simply and purely not supported.</p><p>The <code>foreach</code>-style <code>for</code> is still supported mind you, but the old integer-based counter is not.
You will have to accept to write a while loop, that&rsquo;s not the end of the world though!</p><p>Coming to think of it a bit more, the C-style <code>for</code> syntax we are so used to is quite weird after all -
three expressions inside of a single parenthesis set? Zig simply forces us to be slightly more verbose, nothing crazy in my opinion.</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>There&rsquo;s plenty of interesting subjects I didn&rsquo;t talk about of course, but hopefully this gives you some insights into this shiny language.
On my end, I&rsquo;m interested into what Zig will evolve into, I see a good potential there.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ryp.github.io/tags/zig/>zig</a></li><li><a href=https://ryp.github.io/tags/chip8/>chip8</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://ryp.github.io/>Pixels May Jitter</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>