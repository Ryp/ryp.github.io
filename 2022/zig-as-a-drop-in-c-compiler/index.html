<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Zig as a Drop-in C++ Compiler | Pixels May Jitter</title>
<meta name=keywords content="zig,cpp,reaper"><meta name=description content="Alright, mad scientist time: you guys know about Zig? This language in interesting in itself and I recommend you check it out if you didn&rsquo;t before, but for today we&rsquo;re staying in magical C++ land.
Got the idea from this blog post that I could use the Zig compiler as replacement for Clang, GCC and MSVC in my engine and stop having to use Visual Studio on windows.
Sounds enticing, right?"><meta name=author content><link rel=canonical href=https://ryp.github.io/2022/zig-as-a-drop-in-c-compiler/><link crossorigin=anonymous href=/assets/css/stylesheet.9329d037bc79464b26647fb72e079cd738f5d2418b1df4da3b515db9e22cb4d9.css integrity="sha256-kynQN7x5RksmZH+3Lgec1zj10kGLHfTaO1FdueIstNk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://ryp.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ryp.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ryp.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ryp.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ryp.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Zig as a Drop-in C++ Compiler"><meta property="og:description" content="Alright, mad scientist time: you guys know about Zig? This language in interesting in itself and I recommend you check it out if you didn&rsquo;t before, but for today we&rsquo;re staying in magical C++ land.
Got the idea from this blog post that I could use the Zig compiler as replacement for Clang, GCC and MSVC in my engine and stop having to use Visual Studio on windows.
Sounds enticing, right?"><meta property="og:type" content="article"><meta property="og:url" content="https://ryp.github.io/2022/zig-as-a-drop-in-c-compiler/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-09T20:37:12+03:00"><meta property="article:modified_time" content="2022-06-09T20:37:12+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zig as a Drop-in C++ Compiler"><meta name=twitter:description content="Alright, mad scientist time: you guys know about Zig? This language in interesting in itself and I recommend you check it out if you didn&rsquo;t before, but for today we&rsquo;re staying in magical C++ land.
Got the idea from this blog post that I could use the Zig compiler as replacement for Clang, GCC and MSVC in my engine and stop having to use Visual Studio on windows.
Sounds enticing, right?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ryp.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Zig as a Drop-in C++ Compiler","item":"https://ryp.github.io/2022/zig-as-a-drop-in-c-compiler/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Zig as a Drop-in C++ Compiler","name":"Zig as a Drop-in C\u002b\u002b Compiler","description":"Alright, mad scientist time: you guys know about Zig? This language in interesting in itself and I recommend you check it out if you didn\u0026rsquo;t before, but for today we\u0026rsquo;re staying in magical C++ land.\nGot the idea from this blog post that I could use the Zig compiler as replacement for Clang, GCC and MSVC in my engine and stop having to use Visual Studio on windows.\nSounds enticing, right?","keywords":["zig","cpp","reaper"],"articleBody":"Alright, mad scientist time: you guys know about Zig? This language in interesting in itself and I recommend you check it out if you didn’t before, but for today we’re staying in magical C++ land.\nGot the idea from this blog post that I could use the Zig compiler as replacement for Clang, GCC and MSVC in my engine and stop having to use Visual Studio on windows.\nSounds enticing, right? Setting up VS is always a pain, especially if your main dev machine isn’t Windows, or you want to execute your CI there.\nThe Dirty Details Getting started was quite fast, I already had a C++ project lying around and a zig compiler.\nThe first step is override the compiler, with CMake that meant replacing the CXX env var with a Zig invocation and starting a CMake build.\n$ CXX='zig c++' cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=Debug Then you can start building, and hope for the best! This step required me fix a few details:\nRemove precompiled headers - you probably can find a way around this, but for me it was just easier to rip everything out. Remove unity build support - CMake has a pluging called cotire that lets you do that, to the trash it goes! An couple of hours of hacking later I was up and running on Linux, and not long after Windows support followed.\nOn windows I expected it to be a pain, but it really wasn’t:\nDownload a 50MB tarball of the compiler. Setup Ninja and tell CMake about it. Remove dependencies on the recent Windows SDK. One workaround to this is to dynamic load those symbols from the windows DLLs instead of relying on the headers. Zig comes with the compiler binary and for everything else it compiles from source - that means it bundles everything you need for all platforms. You don’t need to depend on local stuff, even for the standard library! Because of that, the Windows headers don’t provide us the latest API.\nProfit The small upside is that I could selectively run on older versions of Windows if I wanted to in the future, and just fallback on the older API.\nBut finally, we got what we came for, no need for Visual Studio on Windows!\nNow that’s all nice and everything, but the cool stuff doesn’t stop there! Zig has excellent support for cross-compiling, by design.\nNext steps If I bothered to set up my dependencies correctly, I could compile everything from windows or linux, and generate binaries for all targets there. Could even add 64-bit ARM or Mac if I wanted!\nI tried this on another project with fewer dependencies and it worked flawlessly, maybe I’ll spend the time to add it for my engine as well. Just imagine how much simpler my CI scripts and maintenance would be, I could just setup a Linux CI and be done with it!\nZig also has support for its own build system that is written in Zig, so since I’m already using the compiler, I could go further and start to replace CMake with parts of Zig code. From there you can go crazy and even slowly port C++ parts of the engine to Zig while having both parts coexist!\nConclusion What do we get from all this?\nNo need for Visual Studio for compilation on windows I can run and compile from VSCode What more can I get in the future?\nCross compile to every platform Better CI Replace CMake with Zig’s build system? Write parts of my engine in Zig? That’ll be it for this one, thanks for coming to my Ted talk!\n","wordCount":"606","inLanguage":"en","datePublished":"2022-06-09T20:37:12+03:00","dateModified":"2022-06-09T20:37:12+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ryp.github.io/2022/zig-as-a-drop-in-c-compiler/"},"publisher":{"@type":"Organization","name":"Pixels May Jitter","logo":{"@type":"ImageObject","url":"https://ryp.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ryp.github.io/ accesskey=h title="Pixels May Jitter (Alt + H)">Pixels May Jitter</a><div class=logo-switches></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Zig as a Drop-in C++ Compiler</h1><div class=post-meta><span title='2022-06-09 20:37:12 +0300 +0300'>June 9, 2022</span></div></header><div class=post-content><p>Alright, mad scientist time: you guys know about <a href=https://ziglang.org/>Zig</a>?
This language in interesting in itself and I recommend you check it out if you didn&rsquo;t before, but for today we&rsquo;re staying in magical C++ land.</p><p>Got the idea from <a href=https://andrewkelley.me/post/zig-cc-powerful-drop-in-replacement-gcc-clang.html>this blog post</a> that I could use the Zig compiler as replacement for Clang, GCC and MSVC
in my engine and stop having to use Visual Studio on windows.</p><p>Sounds enticing, right? Setting up VS is always a pain, especially if your main dev machine isn&rsquo;t Windows, or you want to execute your CI there.</p><h1 id=the-dirty-details>The Dirty Details<a hidden class=anchor aria-hidden=true href=#the-dirty-details>#</a></h1><p>Getting started was quite fast, I already had a <a href=https://github.com/Ryp/reaper>C++ project lying around</a> and a zig compiler.</p><p>The first step is override the compiler, with CMake that meant replacing the <code>CXX</code> env var with a Zig invocation and starting a CMake build.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ CXX<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;zig c++&#39;</span> cmake -H. -Bbuild -DCMAKE_BUILD_TYPE<span style=color:#f92672>=</span>Debug
</span></span></code></pre></div><p>Then you can start building, and hope for the best! This step required me fix a few details:</p><ul><li>Remove precompiled headers - you probably can find a way around this, but for me it was just easier to rip everything out.</li><li>Remove unity build support - CMake has a pluging called <code>cotire</code> that lets you do that, to the trash it goes!</li></ul><p>An couple of hours of hacking later I was up and running on Linux, and not long after Windows support followed.</p><p>On windows I expected it to be a pain, but it really wasn&rsquo;t:</p><ul><li>Download a 50MB tarball of the compiler.</li><li>Setup Ninja and tell CMake about it.</li><li>Remove dependencies on the recent Windows SDK. One workaround to this is to dynamic load those symbols from the windows DLLs instead of relying on the headers.</li></ul><p>Zig comes with the compiler binary and for everything else it compiles from source - that means it bundles everything you need for all platforms. You don&rsquo;t need to depend on local stuff, even for the standard library!
Because of that, the Windows headers don&rsquo;t provide us the latest API.</p><h1 id=profit>Profit<a hidden class=anchor aria-hidden=true href=#profit>#</a></h1><p>The small upside is that I could selectively run on older versions of Windows if I wanted to in the future, and just fallback on the older API.</p><p>But finally, we got what we came for, no need for Visual Studio on Windows!</p><p>Now that&rsquo;s all nice and everything, but the cool stuff doesn&rsquo;t stop there!
Zig has excellent support for cross-compiling, by design.</p><h1 id=next-steps>Next steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h1><p>If I bothered to set up my dependencies correctly, I could compile everything from windows or linux, and generate binaries for all targets there. Could even add 64-bit ARM or Mac if I wanted!</p><p>I tried this on another project with fewer dependencies and it worked flawlessly, maybe I&rsquo;ll spend the time to add it for my engine as well.
Just imagine how much simpler my CI scripts and maintenance would be, I could just setup a Linux CI and be done with it!</p><p>Zig also has support for its own build system that is written in Zig, so since I&rsquo;m already using the compiler, I could go further and start to replace CMake with parts of Zig code.
From there you can go crazy and even slowly port C++ parts of the engine to Zig while having both parts coexist!</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>What do we get from all this?</p><ul><li>No need for Visual Studio for compilation on windows</li><li>I can run and compile from VSCode</li></ul><p>What more can I get in the future?</p><ul><li>Cross compile to every platform</li><li>Better CI</li><li>Replace CMake with Zig&rsquo;s build system?</li><li>Write parts of my engine in Zig?</li></ul><p>That&rsquo;ll be it for this one, thanks for coming to my Ted talk!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ryp.github.io/tags/zig/>zig</a></li><li><a href=https://ryp.github.io/tags/cpp/>cpp</a></li><li><a href=https://ryp.github.io/tags/reaper/>reaper</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://ryp.github.io/>Pixels May Jitter</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>